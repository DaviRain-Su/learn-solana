---
sidebar_position: 74
sidebar_label: ğŸ§ª æµ‹è¯• Solana ç¨‹åº
sidebar_class_name: green
---

# ğŸ§ª æµ‹è¯• Solana ç¨‹åº - è®©Bugæ— å¤„è—èº«ï¼

## ğŸ¯ æ¬¢è¿æ¥åˆ°æµ‹è¯•çš„ä¸–ç•Œï¼

å˜¿ï¼ŒSolanaå¼€å‘è€…ä»¬ï¼ğŸ‘‹ è¿˜è®°å¾—é‚£äº›è®©ä½ åŠå¤œæƒŠé†’çš„Bugå—ï¼Ÿä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ å¦‚ä½•**åœ¨Bugå‡ºç°ä¹‹å‰å°±æ¶ˆç­å®ƒä»¬**ï¼

æµ‹è¯•å°±åƒæ˜¯ä½ ä»£ç çš„**å¥èº«æ•™ç»ƒ**ğŸ’ª â€”â€” å®ƒè®©ä½ çš„ç¨‹åºæ›´å¼ºå£®ã€æ›´å¯é ï¼è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºä¸€ä¸ª**é“œå¢™é“å£**çš„æµ‹è¯•ä½“ç³»ï¼

> ğŸ¯ **ä»Šæ—¥ä»»åŠ¡ï¼š** æŒæ¡å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œæˆä¸ºBugç»ˆç»“è€…ï¼

---

## ğŸ—ï¸ æµ‹è¯•æ¶æ„æ€»è§ˆ

### ğŸ¨ æµ‹è¯•é‡‘å­—å¡”

```
         ğŸ”ï¸ æµ‹è¯•é‡‘å­—å¡”
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

           â•±     â•²
          â•±  E2E  â•²    â† ğŸŒ ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆæœ€å°‘ä½†æœ€é‡è¦ï¼‰
         â•±  æµ‹è¯•   â•²
        â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
       â•±  é›†æˆæµ‹è¯•   â•²  â† ğŸ”— é›†æˆæµ‹è¯•ï¼ˆä¸­ç­‰æ•°é‡ï¼‰
      â•±               â•²
     â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
    â•±    å•å…ƒæµ‹è¯•       â•² â† ğŸ§© å•å…ƒæµ‹è¯•ï¼ˆæœ€å¤šæœ€å¿«ï¼‰
   â•±___________________â•²

   å¿«é€Ÿ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ…¢é€Ÿ
   ä¾¿å®œ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ˜‚è´µ
   éš”ç¦» â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ çœŸå®
```

### ğŸ“Š ä¸¤ç§æµ‹è¯•ç±»å‹å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç‰¹æ€§       â”‚   å•å…ƒæµ‹è¯• ğŸ§©    â”‚   é›†æˆæµ‹è¯• ğŸ”—     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æµ‹è¯•èŒƒå›´     â”‚   å•ä¸ªå‡½æ•°       â”‚   å¤šä¸ªæ¨¡å—        â”‚
â”‚ é€Ÿåº¦        â”‚   æå¿« âš¡        â”‚   è¾ƒæ…¢ ğŸ¢        â”‚
â”‚ éš”ç¦»æ€§      â”‚   å®Œå…¨éš”ç¦»       â”‚   éƒ¨åˆ†éš”ç¦»        â”‚
â”‚ å¤æ‚åº¦      â”‚   ç®€å• ğŸ“—        â”‚   å¤æ‚ ğŸ“•        â”‚
â”‚ åé¦ˆé€Ÿåº¦    â”‚   å³æ—¶ â±ï¸        â”‚   å»¶è¿Ÿ â³        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© å•å…ƒæµ‹è¯• - ä»£ç çš„ä½“æ£€

### ğŸ¯ ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Ÿ

å•å…ƒæµ‹è¯•å°±åƒç»™ä½ çš„æ¯ä¸ªå‡½æ•°åš**ä½“æ£€**ğŸ¥ï¼å®ƒä»¬ï¼š
- ğŸ” **æ£€æŸ¥å•ä¸ªåŠŸèƒ½** - ä¸€æ¬¡åªæµ‹è¯•ä¸€ä¸ªå‡½æ•°
- âš¡ **è¿è¡Œè¶…å¿«** - æ¯«ç§’çº§å“åº”
- ğŸ¯ **ç²¾å‡†å®šä½** - ç«‹å³æ‰¾åˆ°é—®é¢˜æ‰€åœ¨
- ğŸ”’ **æµ‹è¯•ç§æœ‰æ¥å£** - èƒ½è®¿é—®å†…éƒ¨å®ç°

### ğŸ“ åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå•å…ƒæµ‹è¯•

```rust
// ğŸ  åœ¨ processor.rs æ–‡ä»¶åº•éƒ¨æ·»åŠ æµ‹è¯•æ¨¡å—
#[cfg(test)]  // ğŸ¯ åªåœ¨æµ‹è¯•æ—¶ç¼–è¯‘è¿™æ®µä»£ç 
mod tests {
    use super::*;  // å¯¼å…¥çˆ¶æ¨¡å—çš„æ‰€æœ‰å†…å®¹

    // ğŸ§ª æµ‹è¯•å±æ€§ - æ ‡è®°è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‡½æ•°
    #[test]
    fn test_basic_math() {
        // ğŸ“ å‡†å¤‡æµ‹è¯•æ•°æ®
        let a = 2;
        let b = 2;

        // ğŸ¯ æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
        let result = a + b;

        // âœ… æ–­è¨€ç»“æœ
        assert_eq!(result, 4, "2 + 2 åº”è¯¥ç­‰äº 4ï¼");

        // ğŸ‰ å¦‚æœåˆ°è¿™é‡Œæ²¡æŠ¥é”™ï¼Œæµ‹è¯•é€šè¿‡ï¼
    }

    // ğŸ”§ è¾…åŠ©å‡½æ•°ï¼ˆä¸æ˜¯æµ‹è¯•ï¼‰
    fn helper_setup() -> TestAccount {
        // å‡†å¤‡æµ‹è¯•ç¯å¢ƒçš„è¾…åŠ©å‡½æ•°
        TestAccount::new()
    }

    // ğŸ˜± æµ‹è¯•é¢„æœŸçš„panic
    #[test]
    #[should_panic(expected = "é™¤é›¶é”™è¯¯")]
    fn test_division_by_zero() {
        let result = divide(10, 0);  // è¿™åº”è¯¥panicï¼
    }
}
```

> ğŸ’¡ **Pro Tip:** `#[cfg(test)]` ç¡®ä¿æµ‹è¯•ä»£ç ä¸ä¼šè¢«åŒ…å«åœ¨æœ€ç»ˆçš„ç¨‹åºä¸­ï¼ŒèŠ‚çœç©ºé—´ï¼

---

## ğŸš€ ç¼–å†™Solanaç¨‹åºå•å…ƒæµ‹è¯•

### ğŸ› ï¸ è®¾ç½®æµ‹è¯•ç¯å¢ƒ

```rust
// ğŸ§ª å®Œæ•´çš„Solanaç¨‹åºå•å…ƒæµ‹è¯•ç¤ºä¾‹
#[cfg(test)]
mod tests {
    use {
        super::*,
        assert_matches::*,  // ğŸ¯ å¼ºå¤§çš„æ–­è¨€åŒ¹é…åº“
        solana_program::instruction::{AccountMeta, Instruction},
        solana_program_test::*,  // ğŸ—ï¸ Solanaæµ‹è¯•æ¡†æ¶
        solana_sdk::{
            signature::Signer,
            transaction::Transaction,
            signer::keypair::Keypair
        },
    };

    // ğŸŒŸ ä½¿ç”¨tokioè¿›è¡Œå¼‚æ­¥æµ‹è¯•
    #[tokio::test]
    async fn test_initialize_movie_review() {
        // ğŸ­ Step 1: è®¾ç½®æµ‹è¯•ç¯å¢ƒ
        println!("ğŸš€ å¼€å§‹æµ‹è¯•åˆå§‹åŒ–ç”µå½±è¯„è®º...");

        // åˆ›å»ºå”¯ä¸€çš„ç¨‹åºID
        let program_id = Pubkey::new_unique();

        // ğŸ—ï¸ Step 2: åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
        // ProgramTeståˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„Solanaè¿è¡Œæ—¶
        let (mut banks_client, payer, recent_blockhash) = ProgramTest::new(
            "movie_review_program",  // ç¨‹åºåç§°
            program_id,              // ç¨‹åºID
            processor!(process_instruction),  // å¤„ç†å™¨å‡½æ•°
        )
        .start()  // å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
        .await;

        println!("âœ… æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆï¼");

        // ğŸ‘¤ Step 3: åˆ›å»ºæµ‹è¯•è´¦æˆ·
        let reviewer = Keypair::new();
        let pda_account = Keypair::new();

        // ğŸ“ Step 4: å‡†å¤‡æŒ‡ä»¤æ•°æ®
        let title = "Inception";
        let rating = 5u8;
        let description = "Mind-bending masterpiece!";

        // åºåˆ—åŒ–æŒ‡ä»¤æ•°æ®
        let mut instruction_data = vec![0];  // 0 = AddMovieReviewæŒ‡ä»¤
        instruction_data.extend_from_slice(title.as_bytes());
        instruction_data.push(rating);
        instruction_data.extend_from_slice(description.as_bytes());

        // ğŸ”¨ Step 5: åˆ›å»ºäº¤æ˜“
        let mut transaction = Transaction::new_with_payer(
            &[Instruction {
                program_id,
                accounts: vec![
                    AccountMeta::new(payer.pubkey(), true),     // ä»˜æ¬¾äºº
                    AccountMeta::new(pda_account.pubkey(), false), // PDAè´¦æˆ·
                    AccountMeta::new_readonly(system_program::id(), false), // ç³»ç»Ÿç¨‹åº
                ],
                data: instruction_data,
            }],
            Some(&payer.pubkey()),  // è®¾ç½®ä»˜æ¬¾äºº
        );

        // âœï¸ Step 6: ç­¾åäº¤æ˜“
        transaction.sign(&[&payer], recent_blockhash);

        // ğŸš€ Step 7: å‘é€å¹¶éªŒè¯äº¤æ˜“
        let result = banks_client.process_transaction(transaction).await;

        // âœ… Step 8: æ–­è¨€ç»“æœ
        assert_matches!(result, Ok(()), "äº¤æ˜“åº”è¯¥æˆåŠŸï¼");
        println!("ğŸ‰ æµ‹è¯•é€šè¿‡ï¼ç”µå½±è¯„è®ºåˆ›å»ºæˆåŠŸï¼");
    }

    // ğŸ§ª æµ‹è¯•é”™è¯¯åœºæ™¯
    #[tokio::test]
    async fn test_invalid_rating() {
        let program_id = Pubkey::new_unique();

        // ... è®¾ç½®ä»£ç  ...

        // ğŸš« ä½¿ç”¨æ— æ•ˆè¯„åˆ†ï¼ˆå¤§äº5ï¼‰
        let invalid_rating = 10u8;

        // ... åˆ›å»ºäº¤æ˜“ ...

        // æœŸæœ›äº¤æ˜“å¤±è´¥
        let result = banks_client.process_transaction(transaction).await;
        assert!(result.is_err(), "æ— æ•ˆè¯„åˆ†åº”è¯¥å¯¼è‡´é”™è¯¯ï¼");
        println!("âœ… æ­£ç¡®æ‹’ç»äº†æ— æ•ˆè¯„åˆ†ï¼");
    }
}
```

### ğŸ¯ è¿è¡Œå•å…ƒæµ‹è¯•

```bash
# ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test-sbf

# ğŸ¯ è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test-sbf test_initialize_movie_review

# ğŸ“ æ˜¾ç¤ºæ‰“å°è¾“å‡º
cargo test-sbf -- --nocapture

# âš¡ å¹¶è¡Œè¿è¡Œæµ‹è¯•
cargo test-sbf -- --test-threads=4
```

---

## ğŸ”— é›†æˆæµ‹è¯• - ç³»ç»Ÿçš„å…¨é¢ä½“æ£€

### ğŸ—ï¸ è®¾ç½®é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•ç¡®ä¿ä½ çš„ç¨‹åºå„ä¸ªéƒ¨åˆ†èƒ½å¤Ÿ**ååŒå·¥ä½œ**ï¼

#### ğŸ“ åˆ›å»ºæµ‹è¯•ç›®å½•ç»“æ„

```
ğŸ“¦ your-project/
â”œâ”€â”€ ğŸ“‚ src/
â”‚   â””â”€â”€ ğŸ“œ lib.rs
â”œâ”€â”€ ğŸ“‚ tests/           # ğŸ†• é›†æˆæµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“œ integration_test.rs
â”‚   â””â”€â”€ ğŸ“œ e2e_test.rs
â””â”€â”€ ğŸ“œ Cargo.toml
```

#### ğŸ“ ç¼–å†™é›†æˆæµ‹è¯•

```rust
// ğŸ§ª tests/integration_test.rs
use movie_review_program;  // å¯¼å…¥ä½ çš„ç¨‹åºåº“
use solana_program_test::*;
use solana_sdk::{
    pubkey::Pubkey,
    signature::{Keypair, Signer},
    transaction::Transaction,
};

// ğŸŒŸ é›†æˆæµ‹è¯• - æµ‹è¯•å®Œæ•´çš„å·¥ä½œæµç¨‹
#[tokio::test]
async fn test_complete_review_workflow() {
    println!("ğŸ¬ å¼€å§‹å®Œæ•´å·¥ä½œæµç¨‹æµ‹è¯•...");

    // ğŸ—ï¸ Step 1: è®¾ç½®æµ‹è¯•ç¯å¢ƒ
    let program_id = Pubkey::new_unique();
    let mut program_test = ProgramTest::new(
        "movie_review_program",
        program_id,
        processor!(movie_review_program::process_instruction),
    );

    // ğŸ’° æ·»åŠ ä¸€äº›æµ‹è¯•è´¦æˆ·
    program_test.add_account(
        test_account_pubkey,
        Account {
            lamports: 1_000_000_000,  // 1 SOL
            ..Account::default()
        },
    );

    let (mut banks_client, payer, recent_blockhash) = program_test.start().await;

    // ğŸ“ Step 2: åˆ›å»ºç”µå½±è¯„è®º
    println!("ğŸ“ åˆ›å»ºç”µå½±è¯„è®º...");
    let review_result = create_movie_review(
        &mut banks_client,
        &payer,
        "The Matrix",
        5,
        "Revolutionary sci-fi!",
    ).await;
    assert!(review_result.is_ok(), "åˆ›å»ºè¯„è®ºå¤±è´¥ï¼");

    // ğŸ’¬ Step 3: æ·»åŠ è¯„è®º
    println!("ğŸ’¬ æ·»åŠ è¯„è®º...");
    let comment_result = add_comment(
        &mut banks_client,
        &payer,
        review_pda,
        "Totally agree! Best movie ever!",
    ).await;
    assert!(comment_result.is_ok(), "æ·»åŠ è¯„è®ºå¤±è´¥ï¼");

    // âœï¸ Step 4: æ›´æ–°è¯„è®º
    println!("âœï¸ æ›´æ–°è¯„è®º...");
    let update_result = update_movie_review(
        &mut banks_client,
        &payer,
        "The Matrix",
        5,
        "Revolutionary sci-fi masterpiece!",
    ).await;
    assert!(update_result.is_ok(), "æ›´æ–°è¯„è®ºå¤±è´¥ï¼");

    println!("ğŸ‰ å®Œæ•´å·¥ä½œæµç¨‹æµ‹è¯•é€šè¿‡ï¼");
}

// ğŸ”§ è¾…åŠ©å‡½æ•°
async fn create_movie_review(
    banks_client: &mut BanksClient,
    payer: &Keypair,
    title: &str,
    rating: u8,
    description: &str,
) -> Result<(), Box<dyn std::error::Error>> {
    // å®ç°åˆ›å»ºè¯„è®ºçš„é€»è¾‘
    Ok(())
}
```

---

## ğŸ§ª TypeScripté›†æˆæµ‹è¯•

### ğŸ¯ è®¾ç½®TypeScriptæµ‹è¯•ç¯å¢ƒ

```bash
# ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–
npm install --save-dev mocha chai @types/mocha @types/chai ts-node

# ğŸ¨ å®‰è£…Solanaç›¸å…³åŒ…
npm install @solana/web3.js @solana/spl-token
```

### ğŸ“ é…ç½®package.json

```json
{
  "name": "movie-review-tests",
  "scripts": {
    "test": "mocha -r ts-node/register './test/**/*.test.ts' --timeout 10000",
    "test:watch": "npm run test -- --watch"
  }
}
```

### ğŸš€ ç¼–å†™TypeScriptæµ‹è¯•

```typescript
// ğŸ§ª test/movie-review.test.ts
import { expect } from 'chai';
import * as anchor from '@project-serum/anchor';
import { Program } from '@project-serum/anchor';
import {
    Connection,
    Keypair,
    PublicKey,
    Transaction,
    SystemProgram
} from '@solana/web3.js';

describe('ğŸ¬ Movie Review Program Tests', () => {
    // ğŸŒ è®¾ç½®è¿æ¥å’Œç¨‹åº
    const connection = new Connection('http://localhost:8899', 'confirmed');
    let program: Program;
    let payer: Keypair;

    // ğŸ—ï¸ æµ‹è¯•å‰å‡†å¤‡
    before(async () => {
        console.log('ğŸš€ åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...');

        // åˆ›å»ºä»˜æ¬¾è´¦æˆ·
        payer = Keypair.generate();

        // ç©ºæŠ•ä¸€äº›SOL
        const airdropSig = await connection.requestAirdrop(
            payer.publicKey,
            2 * anchor.web3.LAMPORTS_PER_SOL
        );
        await connection.confirmTransaction(airdropSig);

        console.log('âœ… æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆï¼');
    });

    // ğŸ§ª æµ‹è¯•ï¼šåˆ›å»ºç”µå½±è¯„è®º
    it('åº”è¯¥æˆåŠŸåˆ›å»ºç”µå½±è¯„è®º', async () => {
        console.log('ğŸ“ æµ‹è¯•åˆ›å»ºç”µå½±è¯„è®º...');

        // å‡†å¤‡æµ‹è¯•æ•°æ®
        const title = "Inception";
        const rating = 5;
        const description = "Mind-bending masterpiece!";

        // åˆ›å»ºPDA
        const [reviewPda, bump] = await PublicKey.findProgramAddress(
            [
                Buffer.from("review"),
                payer.publicKey.toBuffer(),
                Buffer.from(title)
            ],
            program.programId
        );

        // æ‰§è¡Œäº¤æ˜“
        const tx = await program.methods
            .addMovieReview(title, rating, description)
            .accounts({
                reviewer: payer.publicKey,
                reviewAccount: reviewPda,
                systemProgram: SystemProgram.programId,
            })
            .signers([payer])
            .rpc();

        console.log('ğŸ“‹ äº¤æ˜“ç­¾å:', tx);

        // è·å–å¹¶éªŒè¯è´¦æˆ·æ•°æ®
        const reviewAccount = await program.account.movieReview.fetch(reviewPda);

        // æ–­è¨€
        expect(reviewAccount.title).to.equal(title);
        expect(reviewAccount.rating).to.equal(rating);
        expect(reviewAccount.description).to.equal(description);

        console.log('âœ… ç”µå½±è¯„è®ºåˆ›å»ºæˆåŠŸï¼');
    });

    // ğŸ§ª æµ‹è¯•ï¼šæ·»åŠ è¯„è®º
    it('åº”è¯¥æˆåŠŸæ·»åŠ è¯„è®º', async () => {
        console.log('ğŸ’¬ æµ‹è¯•æ·»åŠ è¯„è®º...');

        const comment = "I totally agree! Amazing movie!";

        // ... å®ç°æ·»åŠ è¯„è®ºçš„æµ‹è¯•é€»è¾‘ ...

        expect(commentAccount.comment).to.equal(comment);
        console.log('âœ… è¯„è®ºæ·»åŠ æˆåŠŸï¼');
    });

    // ğŸ§ª æµ‹è¯•ï¼šé”™è¯¯å¤„ç†
    it('åº”è¯¥æ‹’ç»æ— æ•ˆçš„è¯„åˆ†', async () => {
        console.log('ğŸš« æµ‹è¯•æ— æ•ˆè¯„åˆ†å¤„ç†...');

        const invalidRating = 10; // è¶…è¿‡5çš„è¯„åˆ†

        try {
            await program.methods
                .addMovieReview("Test Movie", invalidRating, "Test")
                .accounts({/* ... */})
                .rpc();

            // å¦‚æœæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œæµ‹è¯•å¤±è´¥
            expect.fail('åº”è¯¥æŠ›å‡ºé”™è¯¯ï¼');
        } catch (error) {
            // éªŒè¯é”™è¯¯æ¶ˆæ¯
            expect(error.message).to.include('InvalidRating');
            console.log('âœ… æ­£ç¡®æ‹’ç»äº†æ— æ•ˆè¯„åˆ†ï¼');
        }
    });

    // ğŸ§¹ æµ‹è¯•åæ¸…ç†
    after(async () => {
        console.log('ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ...');
        // æ¸…ç†ä»£ç 
    });
});
```

### ğŸš€ è¿è¡ŒTypeScriptæµ‹è¯•

```bash
# ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# ğŸ‘€ ç›‘è§†æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡æ–°è¿è¡Œï¼‰
npm run test:watch

# ğŸ¯ è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- test/movie-review.test.ts

# ğŸ“Š ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

---

## ğŸš¨ é”™è¯¯å¤„ç†ä¸è°ƒè¯•

### ğŸ” ç†è§£é”™è¯¯ä»£ç 

```rust
// ğŸ¯ è‡ªå®šä¹‰é”™è¯¯æšä¸¾
#[derive(Debug, Error)]
pub enum MovieReviewError {
    #[error("0x01 - èµ„é‡‘ä¸è¶³")]  // é”™è¯¯ä»£ç  0x01
    InsufficientFunds,

    #[error("0x02 - è¯„åˆ†æ— æ•ˆ")]  // é”™è¯¯ä»£ç  0x02
    InvalidRating,

    #[error("0x03 - æ ‡é¢˜å¤ªé•¿")]  // é”™è¯¯ä»£ç  0x03
    TitleTooLong,
}

// ğŸ”§ é”™è¯¯ä»£ç è½¬æ¢è¾…åŠ©å‡½æ•°
pub fn decode_error(error_code: u32) -> String {
    match error_code {
        0x01 => "èµ„é‡‘ä¸è¶³ ğŸ’¸".to_string(),
        0x02 => "è¯„åˆ†æ— æ•ˆ â­".to_string(),
        0x03 => "æ ‡é¢˜å¤ªé•¿ ğŸ“".to_string(),
        _ => format!("æœªçŸ¥é”™è¯¯: 0x{:02X}", error_code),
    }
}
```

### ğŸ“œ ç¨‹åºæ—¥å¿—æœ€ä½³å®è·µ

```rust
use solana_program::msg;

pub fn process_instruction(
    program_id: &Pubkey,
    accounts: &[AccountInfo],
    instruction_data: &[u8],
) -> ProgramResult {
    // ğŸ¬ å¼€å§‹æ—¥å¿—
    msg!("ğŸš€ ç¨‹åºå¼€å§‹æ‰§è¡Œ");
    msg!("ğŸ“‹ ç¨‹åºID: {}", program_id);
    msg!("ğŸ“Š è´¦æˆ·æ•°é‡: {}", accounts.len());
    msg!("ğŸ“¦ æ•°æ®é•¿åº¦: {} å­—èŠ‚", instruction_data.len());

    // ğŸ” è¯¦ç»†æ—¥å¿—
    #[cfg(feature = "debug")]
    {
        msg!("ğŸ” è°ƒè¯•æ¨¡å¼ - è¯¦ç»†ä¿¡æ¯:");
        for (i, account) in accounts.iter().enumerate() {
            msg!("  è´¦æˆ·[{}]: {}", i, account.key);
            msg!("    å¯å†™: {}", account.is_writable);
            msg!("    ç­¾å: {}", account.is_signer);
        }
    }

    // âš ï¸ é”™è¯¯æ—¥å¿—
    if instruction_data.is_empty() {
        msg!("âŒ é”™è¯¯ï¼šæŒ‡ä»¤æ•°æ®ä¸ºç©ºï¼");
        return Err(ProgramError::InvalidInstructionData);
    }

    // âœ… æˆåŠŸæ—¥å¿—
    msg!("âœ… å¤„ç†å®Œæˆï¼");
    Ok(())
}
```

> ğŸ’¡ **Pro Tip:** åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ `println!()` è€Œä¸æ˜¯ `msg!()`ï¼

---

## ğŸ’» è®¡ç®—é¢„ç®—ç®¡ç†

### ğŸ“Š ç†è§£è®¡ç®—é™åˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ’» Solanaè®¡ç®—é¢„ç®—               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é»˜è®¤é¢„ç®—: 200K CU Ã— æŒ‡ä»¤æ•°            â”‚
â”‚ æœ€å¤§é¢„ç®—: 1.4M CU                    â”‚
â”‚ åŸºç¡€è´¹ç”¨: 5,000 Lamports             â”‚
â”‚                                      â”‚
â”‚ ä¼˜å…ˆè´¹ç”¨è®¡ç®—:                         â”‚
â”‚ è´¹ç”¨ = CUé¢„ç®— Ã— å¾®Lamports/CU         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ ä¼˜åŒ–è®¡ç®—é¢„ç®—

```typescript
// ğŸ’° è®¾ç½®è‡ªå®šä¹‰è®¡ç®—é¢„ç®—
import { ComputeBudgetProgram } from '@solana/web3.js';

// ğŸš€ åˆ›å»ºä¼˜åŒ–çš„äº¤æ˜“
async function createOptimizedTransaction() {
    // ğŸ“Š Step 1: è®¾ç½®è®¡ç®—å•å…ƒé™åˆ¶
    const modifyComputeUnits = ComputeBudgetProgram.setComputeUnitLimit({
        units: 300_000  // è®¾ç½®ä¸º300K CU
    });

    // ğŸ’¸ Step 2: æ·»åŠ ä¼˜å…ˆè´¹ç”¨ï¼ˆå¯é€‰ï¼‰
    const addPriorityFee = ComputeBudgetProgram.setComputeUnitPrice({
        microLamports: 1000  // æ¯CU 0.001 Lamports
    });

    // ğŸ”¨ Step 3: æ„å»ºäº¤æ˜“
    const transaction = new Transaction()
        .add(modifyComputeUnits)      // å¿…é¡»åœ¨å‰3æ¡æŒ‡ä»¤å†…ï¼
        .add(addPriorityFee)          // ä¼˜å…ˆè´¹ç”¨
        .add(yourInstruction);         // ä½ çš„å®é™…æŒ‡ä»¤

    // ğŸ’¡ è®¡ç®—æ€»è´¹ç”¨
    const baseFee = 5000;  // åŸºç¡€è´¹ç”¨
    const priorityFee = 300_000 * 0.001;  // 300 Lamports
    const totalFee = baseFee + priorityFee;

    console.log(`ğŸ’° é¢„è®¡æ€»è´¹ç”¨: ${totalFee} Lamports`);

    return transaction;
}
```

### ğŸ” ç›‘æ§è®¡ç®—ä½¿ç”¨

```rust
use solana_program::log::sol_log_compute_units;

pub fn process_complex_calculation() -> ProgramResult {
    msg!("ğŸš€ å¼€å§‹å¤æ‚è®¡ç®—...");
    sol_log_compute_units();  // è®°å½•å½“å‰CU

    // æ‰§è¡Œä¸€äº›è®¡ç®—
    perform_heavy_computation()?;

    msg!("ğŸ“Š è®¡ç®—åå‰©ä½™CU:");
    sol_log_compute_units();  // æŸ¥çœ‹ä½¿ç”¨äº†å¤šå°‘

    Ok(())
}
```

---

## ğŸ“¦ æ ˆå†…å­˜ç®¡ç†

### ğŸ¯ é¿å…æ ˆæº¢å‡º

```rust
// âŒ é”™è¯¯ï¼šå¯èƒ½å¯¼è‡´æ ˆæº¢å‡º
fn process_large_data() -> ProgramResult {
    let huge_array = [0u8; 5000];  // 5KB > 4KBæ ˆé™åˆ¶ï¼
    // å¤„ç†...
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å †åˆ†é…
fn process_large_data_safely() -> ProgramResult {
    // ä½¿ç”¨Boxå°†æ•°æ®æ”¾åœ¨å †ä¸Š
    let huge_array = Box::new([0u8; 5000]);  // ç°åœ¨åœ¨å †ä¸Šï¼

    msg!("ğŸ“¦ æ•°æ®å¤§å°: {} å­—èŠ‚", huge_array.len());

    // ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦è®¿é—®æ•°æ®
    let first_byte = (*huge_array)[0];

    Ok(())
}

// ğŸ¯ æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Vec
fn process_dynamic_data() -> ProgramResult {
    // Vecè‡ªåŠ¨åœ¨å †ä¸Šåˆ†é…
    let mut data = Vec::with_capacity(5000);
    data.resize(5000, 0);

    msg!("ğŸ“Š åŠ¨æ€æ•°æ®å‡†å¤‡å®Œæˆ");

    Ok(())
}
```

### ğŸ’¡ å†…å­˜ä¼˜åŒ–æŠ€å·§

```rust
// ğŸ—ï¸ æ™ºèƒ½å†…å­˜ç®¡ç†ç¤ºä¾‹
pub struct OptimizedStorage {
    // å°æ•°æ®ï¼šç›´æ¥å­˜å‚¨
    pub id: u32,                    // 4å­—èŠ‚ï¼Œæ ˆä¸Š
    pub status: u8,                  // 1å­—èŠ‚ï¼Œæ ˆä¸Š

    // å¤§æ•°æ®ï¼šä½¿ç”¨Box
    pub large_data: Box<[u8; 1024]>, // 1KBï¼Œå †ä¸Š

    // åŠ¨æ€æ•°æ®ï¼šä½¿ç”¨Vec
    pub comments: Vec<String>,       // åŠ¨æ€å¤§å°ï¼Œå †ä¸Š
}

impl OptimizedStorage {
    pub fn new() -> Self {
        Self {
            id: 0,
            status: 0,
            large_data: Box::new([0; 1024]),
            comments: Vec::new(),
        }
    }

    // ğŸ” æ£€æŸ¥å†…å­˜ä½¿ç”¨
    pub fn memory_usage(&self) -> usize {
        let stack_usage = std::mem::size_of::<u32>() +
                         std::mem::size_of::<u8>();
        let heap_usage = 1024 +
                        self.comments.capacity() * std::mem::size_of::<String>();

        msg!("ğŸ“Š æ ˆä½¿ç”¨: {} å­—èŠ‚", stack_usage);
        msg!("ğŸ“¦ å †ä½¿ç”¨: {} å­—èŠ‚", heap_usage);

        stack_usage + heap_usage
    }
}
```

---

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### ğŸ“‹ æµ‹è¯•æ¸…å•

```rust
// ğŸ† å®Œç¾çš„æµ‹è¯•ç»“æ„
#[cfg(test)]
mod tests {
    use super::*;

    // ğŸ—ï¸ è®¾ç½®è¾…åŠ©å‡½æ•°
    fn setup() -> TestEnvironment {
        TestEnvironment::new()
    }

    // âœ… æµ‹è¯•æ­£å¸¸è·¯å¾„
    #[test]
    fn test_happy_path() {
        // Given (å‡†å¤‡)
        let env = setup();

        // When (æ‰§è¡Œ)
        let result = perform_action(&env);

        // Then (éªŒè¯)
        assert!(result.is_ok());
    }

    // ğŸš« æµ‹è¯•é”™è¯¯æƒ…å†µ
    #[test]
    fn test_error_cases() {
        // æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯
    }

    // ğŸ” æµ‹è¯•è¾¹ç•Œæ¡ä»¶
    #[test]
    fn test_edge_cases() {
        // æµ‹è¯•æé™æƒ…å†µ
    }

    // ğŸ­ æµ‹è¯•çŠ¶æ€è½¬æ¢
    #[test]
    fn test_state_transitions() {
        // æµ‹è¯•çŠ¶æ€å˜åŒ–
    }
}
```

### ğŸš€ æµ‹è¯•ä¼˜åŒ–æŠ€å·§

1. **å¹¶è¡Œæµ‹è¯•** ğŸš„
   ```bash
   cargo test-sbf -- --test-threads=8
   ```

2. **åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•** ğŸ¯
   ```bash
   cargo test-sbf -- --failed
   ```

3. **æµ‹è¯•è¦†ç›–ç‡** ğŸ“Š
   ```bash
   cargo tarpaulin --out Html
   ```

4. **æ€§èƒ½æµ‹è¯•** âš¡
   ```rust
   #[bench]
   fn bench_process_instruction(b: &mut Bencher) {
       b.iter(|| process_instruction(/*...*/));
   }
   ```

---

## ğŸ“ æ€»ç»“

### ğŸ“š ä½ å­¦åˆ°çš„æŠ€èƒ½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ğŸ† æµ‹è¯•å¤§å¸ˆæŠ€èƒ½                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç¼–å†™å•å…ƒæµ‹è¯•                      â”‚
â”‚ âœ… åˆ›å»ºé›†æˆæµ‹è¯•                      â”‚
â”‚ âœ… TypeScriptæµ‹è¯•                   â”‚
â”‚ âœ… é”™è¯¯å¤„ç†å’Œè°ƒè¯•                    â”‚
â”‚ âœ… è®¡ç®—é¢„ç®—ä¼˜åŒ–                      â”‚
â”‚ âœ… å†…å­˜ç®¡ç†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’¡ è®°ä½è¿™äº›è¦ç‚¹

- ğŸ§ª **æµ‹è¯•æ˜¯æŠ•èµ„** - çŸ­æœŸæˆæœ¬ï¼Œé•¿æœŸæ”¶ç›Š
- ğŸ¯ **æ—©æµ‹è¯•ï¼Œå¸¸æµ‹è¯•** - è¶Šæ—©å‘ç°Bugè¶Šä¾¿å®œ
- ğŸ“Š **è¦†ç›–ç‡ä¸æ˜¯ä¸€åˆ‡** - è´¨é‡æ¯”æ•°é‡é‡è¦
- ğŸš€ **è‡ªåŠ¨åŒ–ä¸€åˆ‡** - CI/CDæ˜¯ä½ çš„æœ‹å‹

---

## ğŸš€ ä¸‹ä¸€æ­¥

æ­å–œä½ æˆä¸ºäº†**æµ‹è¯•å¤§å¸ˆ**ï¼ğŸ‰ ç°åœ¨ä½ å¯ä»¥ï¼š
- æ„å»ºå¯é çš„Solanaç¨‹åº
- å¿«é€Ÿå®šä½å’Œä¿®å¤Bug
- è‡ªä¿¡åœ°éƒ¨ç½²åˆ°ä¸»ç½‘

> ğŸ’¬ **ç»ˆææ™ºæ…§ï¼š** "æœªç»æµ‹è¯•çš„ä»£ç å°±æ˜¯Bugï¼" - æ¯ä¸ªç»éªŒä¸°å¯Œçš„å¼€å‘è€…

---

**è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºæ›´å¯é çš„Web3ä¸–ç•Œï¼** ğŸš€ğŸ§ªâœ¨
